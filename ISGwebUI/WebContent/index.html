<!DOCTYPE html>
<html >
<head>

	<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="pragma" content="no-cache" />

	<!-- Due to a bug in webcomponents, I can't use CSS with HTML imports -->
	<!-- (at least in IE) -->
	<!-- https://github.com/webcomponents/webcomponentsjs/issues/400 -->
	<link rel="stylesheet" href="bootstrap/css/bootstrap-yeti.css"/>
	<link rel="stylesheet" href="css/style.css"/>

	<!-- Polyfill, required for browsers that do not support link rel="import" -->
	<script type="text/javascript" src="webcomponents/webcomponents-lite.min.js"></script>


	<link rel="import" href="html/dependencies.html"/>
</head>
<body>


<div class="container" ng-app="isgWebApp">

	<div ng-controller="isgWebAppCtrl">
		<h2>ISG Cluster Database</h2>
		<p>
		<b>Interferon-stimulated genes</b> (ISGs) are genes whose expression is affected by interferon. 
		ISGs may be duplicated within the genome of a species, and genes in different species may be orthologous.
		These related ISGs therefore form <b>orthologous clusters</b>.
		</p>
		<p>
		Within an orthologous cluster, the effect of interferon varies: some genes are up-regulated, 
		others down-regulated, still others are not differentially expresssed. 
		<p>
		This database catalogues several thousand ISGs across 10 species, grouped into orthologous clusters. 
		For each gene, transcriptomics results for the differential expression of the gene are included.
		</p>
				<p>Gene regulation parameters</p>
				<table class="table table-bordered table-nonfluid">
					<tbody>
						<tr>							
								<td><b>Up-regulated genes:</b></td>
								<td>log<sub>2</sub> FC &gt; <input class="param-text" type="text" 
									ng-model="geneRegulationParams.upregulatedMinLog2FC"/></td>
						</tr>
						<tr>
								<td><b>Down-regulated genes:</b></td>
								<td>log<sub>2</sub> FC &lt; <input class="param-text" type="text" ng-model="geneRegulationParams.downregulatedMaxLog2FC"/></td>
						</tr>
						<tr>
								<td><b>False discovery rate:</b></td>
								<td>FDR &lt; <input class="param-text" type="text" ng-model="geneRegulationParams.maxFDR"/></td>
						</tr>
					</tbody>
				</table>
				<p>Selected clusters must meet all of the following species criteria
				</p>
				<table class="table table-bordered">
					<tbody>
						<tr>							
							<td></td>
							<td>
									Ortholog:
								<div class="btn-group">
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requirePresent')">Present</label>
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requireAbsent')">Absent</label>
								</div>
							</td>
							<td>
									Up-regulated gene:
								<div class="btn-group">
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requireUpregulated')">Present</label>
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requireNotUpregulated')">Absent</label>
								</div>
							</td>
							<td>
									Down-regulated gene:
								<div class="btn-group">
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requireDownregulated')">Present</label>
									<label class="btn btn-primary btn-xs ng-pristine ng-untouched ng-valid active" 
										ng-click="setOnAllSpeciesCriteria('requireNotDownregulated')">Absent</label>
								</div>
							</td>
						</tr>
					
					
					
						<tr ng-repeat="speciesCriterion in speciesCriteria">							
							<td>{{species[speciesCriterion.species].displayName}}</td>
							<td>
									Ortholog:
								<div class="btn-group">
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requirePresent">Present</label>
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requireAbsent">Absent</label>
								</div>
							</td>
							<td>
									Up-regulated gene:
								<div class="btn-group">
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requireUpregulated">Present</label>
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requireNotUpregulated">Absent</label>
								</div>
							</td>
							<td>
									Down-regulated gene:
								<div class="btn-group">
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requireDownregulated">Present</label>
									<label class="btn btn-default btn-xs ng-pristine ng-untouched ng-valid active" 
										btn-checkbox ng-model="speciesCriterion.requireNotDownregulated">Absent</label>
								</div>
							</td>
						</tr>
					</tbody>	
				</table>
				<p><button class="btn btn-default" 
				ng-click="resetSpeciesCriteria()">Reset criteria</button></p>
				<p><button type="button" class="btn btn-default" 
				ng-click="runQuery()" >Run query</button></p>
			<div ng-show="resultRows">
				<h3>Results</h3>
				<div ng-show="resultRows.length == 0">No clusters found for this query</div>
				<div ng-show="resultRows.length > 0">
					<div class='table query-table'>
						<div class="row">
							<button type="button" class="btn btn-default" 
								ng-click="firstPage()">First</button>
							<button type="button" ng-disabled="firstClusterIndex == 1" class="btn btn-default" 
								ng-click="prevPage()">Previous</button>
							<button type="button" ng-disabled="lastClusterIndex == orthoClusters.length" class="btn btn-default" 
								ng-click="nextPage()">Next</button>
							<button type="button" class="btn btn-default" 
								ng-click="lastPage()">Last</button>
						    
							<div class="btn-group" dropdown is-open="status.isopen_numclusters">
						      <button id="numclusters-button" type="button" class="btn btn-default" dropdown-toggle ng-disabled="disabled">
						        Clusters per page: {{clustersPerPage}} <span class="caret"></span>
						      </button>
						      <ul class="dropdown-menu" role="menu" aria-labelledby="numclusters-button">
						        <li ng-repeat="availableClustersPerPageValue in availableClustersPerPage" ng-click="setAvailableClustersPerPage(availableClustersPerPageValue)" role="menuitem"><a >
						        	Clusters per page: {{availableClustersPerPageValue}}</a></li>
						      </ul>
							</div>
							<button type="button" class="btn btn-default" 
								ng-click="clearResults()">Clear results</button>
						    
						</div>
					</div>
					<p>Clusters {{firstClusterIndex}} to {{lastClusterIndex}} of {{orthoClusters.length}}</p>
					<table class="table table-bordered tbl-results">
						<thead>
							<th>Orthologous cluster ID</th>
							<th>Species</th>
							<th>ENSEMBL ID</th>
							<th>Gene</th>
							<th><em>log<sub>2</sub></em> Fold Change</em></th>
							<th>FDR</em></th>
						</thead>		
						<tbody>
							<tr class="{{resultRow.rowClass}}" ng-repeat="resultRow in resultRows track by $index">
								<td ng-show="resultRow.orthoClusterId" rowSpan="{{resultRow.numRowsInCluster}}">{{resultRow.orthoClusterId}}</td>
								<td ng-show="resultRow.species" rowSpan="{{resultRow.numRowsInSpecies}}">{{resultRow.species}}</td>
								<td><a href="http://www.ensembl.org/Gene/Summary?g={{resultRow.ensemblId}}" target="_blank">{{resultRow.ensemblId}}</a></td>
								<td>{{resultRow.geneName}}</td>
								<td>{{resultRow.log2fc}}</td>
								<td>{{resultRow.fdr}}</td>
							</tr>
						</tbody>	
					</table>
				</div>
		  </div>
	</div>

</div>

</body>
</html>